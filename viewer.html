<!DOCTYPE html>
<html>
<head>
    <title>Reader</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; display: flex; margin: 0; height: 100vh; background: #eef0f2; }
        
        /* Modern Sidebar */
        #sidebar { 
            width: 300px; background: #1a1c1e; color: #fff; padding: 25px; 
            display: flex; flex-direction: column; box-shadow: 4px 0 15px rgba(0,0,0,0.2); 
            z-index: 10;
        }
        h3 { font-weight: 600; margin-top: 0; color: #94a3b8; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Glassmorphism Button */
        .btn-main { 
            background: #27ae60; color: white; border: none; padding: 12px; 
            border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 25px;
            transition: opacity 0.2s;
        }
        .btn-main:hover { opacity: 0.9; }

        #bookmark-list { flex-grow: 1; overflow-y: auto; }
        
        .bookmark-item { 
            background: #2c2e33; padding: 12px; margin-bottom: 10px; 
            border-radius: 8px; cursor: pointer; font-size: 0.9rem; border: 1px solid transparent;
            transition: all 0.2s;
        }
        .bookmark-item:hover { border-color: #27ae60; background: #35373d; }
        .bookmark-page { color: #27ae60; font-weight: bold; margin-right: 8px; }

        /* Smooth PDF Viewer */
        #viewer-container { flex-grow: 1; overflow-y: auto; scroll-behavior: smooth; display: flex; flex-direction: column; align-items: center; }
        #pdf-render { padding: 40px 0; }
        canvas { display: block; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); border-radius: 4px; }

        .back-link { color: #94a3b8; text-decoration: none; font-size: 0.85rem; margin-top: 20px; display: block; text-align: center; }
        .back-link:hover { color: white; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3>Library</h3>
    <a href="index.html" class="back-link" style="text-align: left; margin-bottom: 30px; margin-top: 0;">‚Üê Back to Home</a>
    
    <h3>Current Book</h3>
    <button class="btn-main" onclick="saveBookmark()">+ New Bookmark</button>
    
    <div id="bookmark-list"></div>
</div>

<div id="viewer-container">
    <div id="pdf-render"></div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const pdfFile = urlParams.get('file');
    const container = document.getElementById('viewer-container');
    let pdfDoc = null;

    pdfjsLib.getDocument(pdfFile).promise.then(doc => {
        pdfDoc = doc;
        renderPages();
        loadBookmarks();
    });

    async function renderPages() {
        const renderContainer = document.getElementById('pdf-render');
        for (let i = 1; i <= pdfDoc.numPages; i++) {
            const page = await pdfDoc.getPage(i);
            const viewport = page.getViewport({ scale: 1.5 });
            const canvas = document.createElement('canvas');
            canvas.id = 'page-' + i;
            renderContainer.appendChild(canvas);
            
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            await page.render({ canvasContext: context, viewport: viewport }).promise;
        }
    }

    function saveBookmark() {
        const pageHeight = document.querySelector('canvas').offsetHeight + 30;
        const currentPage = Math.floor(container.scrollTop / pageHeight) + 1;
        const note = prompt("Bookmark Title:");
        if (!note) return;

        const bookmarks = JSON.parse(localStorage.getItem('bm-' + pdfFile) || '[]');
        bookmarks.push({ name: note, page: currentPage });
        localStorage.setItem('bm-' + pdfFile, JSON.stringify(bookmarks));
        loadBookmarks();
    }

    function loadBookmarks() {
        const list = document.getElementById('bookmark-list');
        const bookmarks = JSON.parse(localStorage.getItem('bm-' + pdfFile) || '[]');
        list.innerHTML = '';
        bookmarks.forEach(bm => {
            const div = document.createElement('div');
            div.className = 'bookmark-item';
            div.innerHTML = `<span class="bookmark-page">p.${bm.page}</span> ${bm.name}`;
            div.onclick = () => document.getElementById('page-' + bm.page).scrollIntoView();
            list.appendChild(div);
        });
    }
</script>
</body>
</html>
